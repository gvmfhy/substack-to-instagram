<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Substack to Instagram Carousel Generator</title>
    <meta name="description" content="Convert your Substack posts and long-form content into beautiful Instagram carousel images">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .input-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        textarea {
            width: 100%;
            height: 400px;
            padding: 15px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 16px;
            font-family: Georgia, serif;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #0095f6;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            background: #0095f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        button:hover {
            background: #0081d6;
        }

        .secondary-btn {
            background: #e4e4e4;
            color: #333;
        }

        .secondary-btn:hover {
            background: #d0d0d0;
        }

        .aspect-select {
            padding: 8px;
            border: 2px solid #e5e5e5;
            border-radius: 6px;
            font-size: 14px;
        }

        .preview-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        canvas {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        .slide-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .slide-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .slide-dot.active {
            background: #333;
            width: 24px;
            border-radius: 4px;
        }

        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100%;
            margin-top: 10px;
        }

        .char-count {
            font-size: 12px;
            color: #666;
            margin-left: auto;
        }

        .status {
            text-align: center;
            margin-top: 10px;
            color: #059669;
            font-size: 14px;
        }

        .info-box {
            background: #f0f9ff;
            border: 1px solid #0284c7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .info-box h3 {
            color: #0c4a6e;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #075985;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .github-corner {
            position: absolute;
            top: 0;
            right: 0;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }

        .footer a {
            color: #0095f6;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <a href="https://github.com/austinmorrissey/substack-to-instagram" class="github-corner" aria-label="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
    </a>

    <div class="container">
        <h1>Substack to Instagram Carousel</h1>
        <p class="subtitle">Transform your long-form content into beautiful Instagram carousels</p>

        <div class="main-grid">
            <div class="input-section">
                <h2>Step 1: Paste Your Text</h2>
                <textarea id="textInput" placeholder="Paste your Substack post, essay, or any long-form content here...

The tool will automatically split it into Instagram-friendly slides that are easy to read and visually appealing."></textarea>
                <div class="controls">
                    <button onclick="generateSlides()">Generate Slides</button>
                    <button class="secondary-btn" onclick="loadSample()">Load Sample</button>
                    <select class="aspect-select" id="aspectRatio">
                        <option value="4:5">Portrait (4:5)</option>
                        <option value="1:1">Square (1:1)</option>
                        <option value="9:16">Story (9:16)</option>
                    </select>
                    <span class="char-count" id="charCount">0 characters</span>
                </div>
                <div class="controls" style="margin-top: 10px;">
                    <input type="text" id="authorHandle" placeholder="Your blog/social handle"
                           value="austinpatrick.substack.com"
                           style="flex: 1; padding: 8px; border: 2px solid #e5e5e5; border-radius: 6px; font-size: 14px;">
                    <button class="secondary-btn" onclick="saveHandle()" style="padding: 8px 16px;">Save</button>
                </div>
                <div class="status" id="status"></div>

                <div class="info-box">
                    <h3>Tips for Best Results</h3>
                    <p>
                        • Keep paragraphs concise for better readability<br>
                        • The tool respects your paragraph breaks<br>
                        • Each slide holds ~300 characters<br>
                        • Use arrow keys to navigate between slides
                    </p>
                </div>
            </div>

            <div class="preview-section">
                <h2>Step 2: Preview & Download</h2>
                <canvas id="previewCanvas"></canvas>
                <div class="slide-nav" id="slideNav"></div>
                <button class="download-btn" onclick="downloadCurrentSlide()">Download This Slide</button>
                <button class="download-btn" onclick="downloadAllSlides()">Download All Slides (ZIP)</button>
            </div>
        </div>

        <div class="footer">
            Created by <a href="https://austinpatrick.substack.com" target="_blank">Austin Morrissey</a> •
            <a href="https://github.com/austinmorrissey/substack-to-instagram" target="_blank">View on GitHub</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        let slides = [];
        let currentSlide = 0;
        let currentAspect = '4:5';

        const dimensions = {
            '1:1': { width: 1080, height: 1080, maxChars: 280 },
            '4:5': { width: 1080, height: 1350, maxChars: 320 },
            '9:16': { width: 1080, height: 1920, maxChars: 400 }
        };

        // Character counter
        document.getElementById('textInput').addEventListener('input', (e) => {
            document.getElementById('charCount').textContent = `${e.target.value.length} characters`;
        });

        // Aspect ratio change
        document.getElementById('aspectRatio').addEventListener('change', (e) => {
            currentAspect = e.target.value;
            if (slides.length > 0) {
                renderSlide();
            }
        });

        function loadSample() {
            const sampleText = `The Power of Writing

Writing is not just about putting words on paper. It's about clarifying your thoughts, organizing your ideas, and communicating effectively with others.

When we write, we're forced to slow down and think deliberately about what we want to say. This process helps us understand our own thoughts better.

Good writing is rewriting. The first draft is just the beginning. Each revision brings us closer to expressing exactly what we mean.

Writing regularly builds a habit of reflection. It creates a record of our thoughts and how they evolve over time.

Share your writing with the world. Your unique perspective might be exactly what someone needs to hear today.`;

            document.getElementById('textInput').value = sampleText;
            document.getElementById('charCount').textContent = `${sampleText.length} characters`;
            generateSlides();
        }

        function generateSlides() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showStatus('Please paste some text first', 'error');
                return;
            }

            // Smart chunking algorithm
            slides = chunkText(text);
            currentSlide = 0;

            // Initialize navigation
            initSlideNav();
            renderSlide();

            showStatus(`Created ${slides.length} slides`, 'success');
        }

        function chunkText(text) {
            const maxChars = dimensions[currentAspect].maxChars;
            const paragraphs = text.split(/\n\n+/);
            const chunks = [];
            let currentChunk = '';

            paragraphs.forEach(paragraph => {
                // Skip empty paragraphs
                if (!paragraph.trim()) return;

                // If paragraph alone is too long, split it
                if (paragraph.length > maxChars) {
                    // Save current chunk if exists
                    if (currentChunk) {
                        chunks.push(currentChunk.trim());
                        currentChunk = '';
                    }

                    // Split long paragraph by sentences
                    const sentences = paragraph.match(/[^.!?]+[.!?]+/g) || [paragraph];
                    sentences.forEach(sentence => {
                        if (currentChunk.length + sentence.length > maxChars) {
                            if (currentChunk) {
                                chunks.push(currentChunk.trim());
                            }
                            currentChunk = sentence.trim();
                        } else {
                            currentChunk += (currentChunk ? ' ' : '') + sentence.trim();
                        }
                    });
                } else {
                    // Check if adding paragraph exceeds limit
                    if (currentChunk.length + paragraph.length + 2 > maxChars) {
                        chunks.push(currentChunk.trim());
                        currentChunk = paragraph;
                    } else {
                        currentChunk += (currentChunk ? '\n\n' : '') + paragraph;
                    }
                }
            });

            // Don't forget last chunk
            if (currentChunk) {
                chunks.push(currentChunk.trim());
            }

            // Format for slides - add footer to first slide only
            // Get handle from input field or use default
            const authorHandle = document.getElementById('authorHandle').value || "austinpatrick.substack.com";

            return chunks.map((content, index) => ({
                id: index + 1,
                content: content,
                footer: index === 0 ? authorHandle : null
            }));
        }

        function initSlideNav() {
            const nav = document.getElementById('slideNav');
            nav.innerHTML = '';
            slides.forEach((slide, index) => {
                const dot = document.createElement('div');
                dot.className = `slide-dot ${index === currentSlide ? 'active' : ''}`;
                dot.onclick = () => {
                    currentSlide = index;
                    updateSlideNav();
                    renderSlide();
                };
                nav.appendChild(dot);
            });
        }

        function updateSlideNav() {
            const dots = document.querySelectorAll('.slide-dot');
            dots.forEach((dot, index) => {
                dot.className = `slide-dot ${index === currentSlide ? 'active' : ''}`;
            });
        }

        function renderSlide(canvas = null, slideIndex = null) {
            if (slides.length === 0) {
                // Render empty state
                const targetCanvas = document.getElementById('previewCanvas');
                const ctx = targetCanvas.getContext('2d');
                targetCanvas.width = 540;
                targetCanvas.height = 675;

                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(0, 0, 540, 675);

                ctx.fillStyle = '#999';
                ctx.font = '24px -apple-system, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Your preview will appear here', 270, 337);
                return;
            }

            const targetCanvas = canvas || document.getElementById('previewCanvas');
            const ctx = targetCanvas.getContext('2d');
            const dims = dimensions[currentAspect];
            const slide = slides[slideIndex !== null ? slideIndex : currentSlide];

            targetCanvas.width = dims.width;
            targetCanvas.height = dims.height;

            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, dims.width, dims.height);
            gradient.addColorStop(0, '#fefcfb');
            gradient.addColorStop(0.5, '#fef9f5');
            gradient.addColorStop(1, '#fef6f0');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, dims.width, dims.height);

            // Progress dots at top
            if (slides.length > 1) {
                const dotY = dims.height * 0.03;
                const totalDots = slides.length;
                const dotSpacing = 12;
                const activeDotWidth = 28;
                const inactiveDotWidth = 8;
                const totalWidth = activeDotWidth + (totalDots - 1) * (inactiveDotWidth + dotSpacing);
                let startX = (dims.width - totalWidth) / 2;

                slides.forEach((_, index) => {
                    const isActive = index === (slideIndex !== null ? slideIndex : currentSlide);
                    ctx.fillStyle = isActive ? '#374151' : '#d1d5db';
                    const dotWidth = isActive ? activeDotWidth : inactiveDotWidth;
                    const dotHeight = 4;

                    ctx.beginPath();
                    ctx.roundRect(startX, dotY, dotWidth, dotHeight, 2);
                    ctx.fill();

                    startX += dotWidth + dotSpacing;
                });
            }

            // Text content
            ctx.fillStyle = '#1f2937';
            ctx.textAlign = 'left';

            // Font sizes based on aspect ratio
            let fontSize, lineHeight, padding;
            if (currentAspect === '9:16') {
                fontSize = dims.width * 0.032;
                lineHeight = 1.85;
                padding = dims.width * 0.1;
            } else if (currentAspect === '1:1') {
                fontSize = dims.width * 0.034;
                lineHeight = 1.8;
                padding = dims.width * 0.12;
            } else { // 4:5
                fontSize = dims.width * 0.036;
                lineHeight = 1.8;
                padding = dims.width * 0.12;
            }

            ctx.font = `${fontSize}px Georgia, serif`;

            // Word wrap and render text
            const maxWidth = dims.width - (padding * 2);
            const lines = wrapText(ctx, slide.content, maxWidth);
            const totalTextHeight = lines.length * fontSize * lineHeight;
            const startY = (dims.height - totalTextHeight) / 2 + fontSize;

            lines.forEach((line, index) => {
                if (line !== '') {
                    ctx.fillText(line, padding, startY + (index * fontSize * lineHeight));
                }
            });

            // Footer (if exists)
            if (slide.footer) {
                ctx.fillStyle = '#dc2626';
                ctx.font = `${fontSize * 0.7}px -apple-system, sans-serif`;
                ctx.textAlign = 'right';
                ctx.fillText(slide.footer + ' →', dims.width - padding, dims.height - padding);
            }

            // Slide counter
            if (slides.length > 1) {
                ctx.fillStyle = '#9ca3af';
                ctx.font = `${fontSize * 0.6}px -apple-system, sans-serif`;
                ctx.textAlign = 'center';
                const slideNum = slideIndex !== null ? slideIndex + 1 : currentSlide + 1;
                ctx.fillText(`${slideNum} / ${slides.length}`, dims.width / 2, dims.height - dims.height * 0.03);
            }

            return targetCanvas;
        }

        function wrapText(ctx, text, maxWidth) {
            const paragraphs = text.split('\n');
            const lines = [];

            paragraphs.forEach(paragraph => {
                if (paragraph === '') {
                    lines.push('');
                } else {
                    const words = paragraph.split(' ');
                    let currentLine = '';

                    words.forEach(word => {
                        const testLine = currentLine + (currentLine ? ' ' : '') + word;
                        const metrics = ctx.measureText(testLine);

                        if (metrics.width > maxWidth && currentLine) {
                            lines.push(currentLine);
                            currentLine = word;
                        } else {
                            currentLine = testLine;
                        }
                    });

                    if (currentLine) {
                        lines.push(currentLine);
                    }
                }
            });

            return lines;
        }

        function downloadCurrentSlide() {
            if (slides.length === 0) {
                showStatus('Generate slides first', 'error');
                return;
            }

            const canvas = document.getElementById('previewCanvas');
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `instagram_${currentAspect.replace(':', 'x')}_slide${currentSlide + 1}.png`;
                a.click();
                URL.revokeObjectURL(url);
                showStatus('Slide downloaded!', 'success');
            }, 'image/png', 1.0);
        }

        async function downloadAllSlides() {
            if (slides.length === 0) {
                showStatus('Generate slides first', 'error');
                return;
            }

            showStatus('Creating ZIP...', 'info');

            const zip = new JSZip();
            const tempCanvas = document.createElement('canvas');

            for (let i = 0; i < slides.length; i++) {
                renderSlide(tempCanvas, i);
                const blob = await new Promise(resolve =>
                    tempCanvas.toBlob(resolve, 'image/png', 1.0)
                );
                zip.file(`slide_${String(i + 1).padStart(2, '0')}_${currentAspect.replace(':', 'x')}.png`, blob);
            }

            const content = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = `instagram_carousel_${currentAspect.replace(':', 'x')}.zip`;
            a.click();
            URL.revokeObjectURL(url);

            showStatus('All slides downloaded!', 'success');
        }

        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.color = type === 'error' ? '#dc2626' : '#059669';
            setTimeout(() => {
                status.textContent = '';
            }, 3000);
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (slides.length === 0) return;

            if (e.key === 'ArrowLeft' && currentSlide > 0) {
                currentSlide--;
                updateSlideNav();
                renderSlide();
            } else if (e.key === 'ArrowRight' && currentSlide < slides.length - 1) {
                currentSlide++;
                updateSlideNav();
                renderSlide();
            }
        });

        // Initialize with empty preview
        renderSlide();

        // Load saved handle on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedHandle = localStorage.getItem('authorHandle');
            if (savedHandle) {
                document.getElementById('authorHandle').value = savedHandle;
            }
        });

        // Save handle to localStorage
        function saveHandle() {
            const handle = document.getElementById('authorHandle').value;
            if (handle) {
                localStorage.setItem('authorHandle', handle);
                showStatus('Handle saved!', 'success');
                // Regenerate slides if they exist
                if (slides.length > 0) {
                    generateSlides();
                }
            }
        }

        // Update handle when Enter is pressed in the input
        document.getElementById('authorHandle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveHandle();
            }
        });
    </script>
</body>
</html>